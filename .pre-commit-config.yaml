repos:
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v4.5.0
  hooks:
    - id: trailing-whitespace
    - id: end-of-file-fixer
    - id: check-yaml
    - id: check-added-large-files

- repo: local
  hooks:
    - id: terraform-fmt
      name: Terraform fmt
      entry: terraform fmt -recursive
      language: system
      files: \.tf$
      pass_filenames: false

    - id: terraform-validate
      name: Terraform validate
      entry: bash -c 'cd environments/dev && terraform init -backend=false && terraform validate'
      language: system
      files: \.tf$
      pass_filenames: false

    - id: generate-diagrams
      name: Generate Infrastructure Diagrams
      entry: python3 scripts/generate_diagrams.py
      language: system
      files: |
        (?x)^(
            modules/.*\.tf|
            environments/.*/.*\.tf|
            kubernetes/manifests/.*\.ya?ml
        )$
      pass_filenames: false

    - id: validate-workflow
      name: Validate Workflow
      entry: scripts/validate_workflow.sh
      language: system
      files: |
        (?x)^(
            \.github/workflows/.*\.ya?ml|
            scripts/.*\.sh|
            \.pre-commit-config\.yaml
        )$
      pass_filenames: false
